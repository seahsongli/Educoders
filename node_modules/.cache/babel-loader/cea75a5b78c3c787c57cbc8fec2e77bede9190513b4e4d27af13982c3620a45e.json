{"ast":null,"code":"import { BaseError } from '../errors/base.js';\nimport { HttpRequestError } from '../errors/request.js';\nimport { ChainDisconnectedError, InternalRpcError, InvalidInputRpcError, InvalidParamsRpcError, InvalidRequestRpcError, JsonRpcVersionUnsupportedError, LimitExceededRpcError, MethodNotFoundRpcError, MethodNotSupportedRpcError, ParseRpcError, ProviderDisconnectedError, ResourceNotFoundRpcError, ResourceUnavailableRpcError, SwitchChainError, TransactionRejectedRpcError, UnauthorizedProviderError, UnknownRpcError, UnsupportedProviderMethodError, UserRejectedRequestError } from '../errors/rpc.js';\nimport { stringToHex } from './encoding/toHex.js';\nimport { keccak256 } from './hash/keccak256.js';\nimport { withDedupe } from './promise/withDedupe.js';\nimport { withRetry } from './promise/withRetry.js';\nimport { stringify } from './stringify.js';\nexport function buildRequest(request, options = {}) {\n  return async (args, overrideOptions = {}) => {\n    const {\n      dedupe = false,\n      retryDelay = 150,\n      retryCount = 3,\n      uid\n    } = {\n      ...options,\n      ...overrideOptions\n    };\n    const requestId = dedupe ? keccak256(stringToHex(`${uid}.${stringify(args)}`)) : undefined;\n    return withDedupe(() => withRetry(async () => {\n      try {\n        return await request(args);\n      } catch (err_) {\n        const err = err_;\n        switch (err.code) {\n          // -32700\n          case ParseRpcError.code:\n            throw new ParseRpcError(err);\n          // -32600\n          case InvalidRequestRpcError.code:\n            throw new InvalidRequestRpcError(err);\n          // -32601\n          case MethodNotFoundRpcError.code:\n            throw new MethodNotFoundRpcError(err, {\n              method: args.method\n            });\n          // -32602\n          case InvalidParamsRpcError.code:\n            throw new InvalidParamsRpcError(err);\n          // -32603\n          case InternalRpcError.code:\n            throw new InternalRpcError(err);\n          // -32000\n          case InvalidInputRpcError.code:\n            throw new InvalidInputRpcError(err);\n          // -32001\n          case ResourceNotFoundRpcError.code:\n            throw new ResourceNotFoundRpcError(err);\n          // -32002\n          case ResourceUnavailableRpcError.code:\n            throw new ResourceUnavailableRpcError(err);\n          // -32003\n          case TransactionRejectedRpcError.code:\n            throw new TransactionRejectedRpcError(err);\n          // -32004\n          case MethodNotSupportedRpcError.code:\n            throw new MethodNotSupportedRpcError(err, {\n              method: args.method\n            });\n          // -32005\n          case LimitExceededRpcError.code:\n            throw new LimitExceededRpcError(err);\n          // -32006\n          case JsonRpcVersionUnsupportedError.code:\n            throw new JsonRpcVersionUnsupportedError(err);\n          // 4001\n          case UserRejectedRequestError.code:\n            throw new UserRejectedRequestError(err);\n          // 4100\n          case UnauthorizedProviderError.code:\n            throw new UnauthorizedProviderError(err);\n          // 4200\n          case UnsupportedProviderMethodError.code:\n            throw new UnsupportedProviderMethodError(err);\n          // 4900\n          case ProviderDisconnectedError.code:\n            throw new ProviderDisconnectedError(err);\n          // 4901\n          case ChainDisconnectedError.code:\n            throw new ChainDisconnectedError(err);\n          // 4902\n          case SwitchChainError.code:\n            throw new SwitchChainError(err);\n          // CAIP-25: User Rejected Error\n          // https://docs.walletconnect.com/2.0/specs/clients/sign/error-codes#rejected-caip-25\n          case 5000:\n            throw new UserRejectedRequestError(err);\n          default:\n            if (err_ instanceof BaseError) throw err_;\n            throw new UnknownRpcError(err);\n        }\n      }\n    }, {\n      delay: ({\n        count,\n        error\n      }) => {\n        // If we find a Retry-After header, let's retry after the given time.\n        if (error && error instanceof HttpRequestError) {\n          const retryAfter = error?.headers?.get('Retry-After');\n          if (retryAfter?.match(/\\d/)) return Number.parseInt(retryAfter) * 1000;\n        }\n        // Otherwise, let's retry with an exponential backoff.\n        return ~~(1 << count) * retryDelay;\n      },\n      retryCount,\n      shouldRetry: ({\n        error\n      }) => shouldRetry(error)\n    }), {\n      enabled: dedupe,\n      id: requestId\n    });\n  };\n}\n/** @internal */\nexport function shouldRetry(error) {\n  if ('code' in error && typeof error.code === 'number') {\n    if (error.code === -1) return true; // Unknown error\n    if (error.code === LimitExceededRpcError.code) return true;\n    if (error.code === InternalRpcError.code) return true;\n    return false;\n  }\n  if (error instanceof HttpRequestError && error.status) {\n    // Forbidden\n    if (error.status === 403) return true;\n    // Request Timeout\n    if (error.status === 408) return true;\n    // Request Entity Too Large\n    if (error.status === 413) return true;\n    // Too Many Requests\n    if (error.status === 429) return true;\n    // Internal Server Error\n    if (error.status === 500) return true;\n    // Bad Gateway\n    if (error.status === 502) return true;\n    // Service Unavailable\n    if (error.status === 503) return true;\n    // Gateway Timeout\n    if (error.status === 504) return true;\n    return false;\n  }\n  return true;\n}","map":{"version":3,"names":["BaseError","HttpRequestError","ChainDisconnectedError","InternalRpcError","InvalidInputRpcError","InvalidParamsRpcError","InvalidRequestRpcError","JsonRpcVersionUnsupportedError","LimitExceededRpcError","MethodNotFoundRpcError","MethodNotSupportedRpcError","ParseRpcError","ProviderDisconnectedError","ResourceNotFoundRpcError","ResourceUnavailableRpcError","SwitchChainError","TransactionRejectedRpcError","UnauthorizedProviderError","UnknownRpcError","UnsupportedProviderMethodError","UserRejectedRequestError","stringToHex","keccak256","withDedupe","withRetry","stringify","buildRequest","request","options","args","overrideOptions","dedupe","retryDelay","retryCount","uid","requestId","undefined","err_","err","code","method","delay","count","error","retryAfter","headers","get","match","Number","parseInt","shouldRetry","enabled","id","status"],"sources":["C:\\Users\\seahs\\repos\\worldcoin-app\\node_modules\\@worldcoin\\idkit-core\\node_modules\\viem\\utils\\buildRequest.ts"],"sourcesContent":["import { BaseError } from '../errors/base.js'\nimport {\n  HttpRequestError,\n  type HttpRequestErrorType,\n  type RpcRequestErrorType,\n  type TimeoutErrorType,\n  type WebSocketRequestErrorType,\n} from '../errors/request.js'\nimport {\n  ChainDisconnectedError,\n  type ChainDisconnectedErrorType,\n  InternalRpcError,\n  type InternalRpcErrorType,\n  InvalidInputRpcError,\n  type InvalidInputRpcErrorType,\n  InvalidParamsRpcError,\n  type InvalidParamsRpcErrorType,\n  InvalidRequestRpcError,\n  type InvalidRequestRpcErrorType,\n  JsonRpcVersionUnsupportedError,\n  type JsonRpcVersionUnsupportedErrorType,\n  LimitExceededRpcError,\n  type LimitExceededRpcErrorType,\n  MethodNotFoundRpcError,\n  type MethodNotFoundRpcErrorType,\n  MethodNotSupportedRpcError,\n  type MethodNotSupportedRpcErrorType,\n  ParseRpcError,\n  type ParseRpcErrorType,\n  ProviderDisconnectedError,\n  type ProviderDisconnectedErrorType,\n  type ProviderRpcErrorCode,\n  ResourceNotFoundRpcError,\n  type ResourceNotFoundRpcErrorType,\n  ResourceUnavailableRpcError,\n  type ResourceUnavailableRpcErrorType,\n  type RpcError,\n  type RpcErrorCode,\n  type RpcErrorType,\n  SwitchChainError,\n  type SwitchChainErrorType,\n  TransactionRejectedRpcError,\n  type TransactionRejectedRpcErrorType,\n  UnauthorizedProviderError,\n  type UnauthorizedProviderErrorType,\n  UnknownRpcError,\n  type UnknownRpcErrorType,\n  UnsupportedProviderMethodError,\n  type UnsupportedProviderMethodErrorType,\n  UserRejectedRequestError,\n  type UserRejectedRequestErrorType,\n} from '../errors/rpc.js'\nimport type { ErrorType } from '../errors/utils.js'\nimport type {\n  EIP1193RequestFn,\n  EIP1193RequestOptions,\n} from '../types/eip1193.js'\nimport { stringToHex } from './encoding/toHex.js'\nimport { keccak256 } from './hash/keccak256.js'\nimport type { CreateBatchSchedulerErrorType } from './promise/createBatchScheduler.js'\nimport { withDedupe } from './promise/withDedupe.js'\nimport { type WithRetryErrorType, withRetry } from './promise/withRetry.js'\nimport type { GetSocketRpcClientErrorType } from './rpc/socket.js'\nimport { stringify } from './stringify.js'\n\nexport type RequestErrorType =\n  | ChainDisconnectedErrorType\n  | CreateBatchSchedulerErrorType\n  | HttpRequestErrorType\n  | InternalRpcErrorType\n  | InvalidInputRpcErrorType\n  | InvalidParamsRpcErrorType\n  | InvalidRequestRpcErrorType\n  | GetSocketRpcClientErrorType\n  | JsonRpcVersionUnsupportedErrorType\n  | LimitExceededRpcErrorType\n  | MethodNotFoundRpcErrorType\n  | MethodNotSupportedRpcErrorType\n  | ParseRpcErrorType\n  | ProviderDisconnectedErrorType\n  | ResourceNotFoundRpcErrorType\n  | ResourceUnavailableRpcErrorType\n  | RpcErrorType\n  | RpcRequestErrorType\n  | SwitchChainErrorType\n  | TimeoutErrorType\n  | TransactionRejectedRpcErrorType\n  | UnauthorizedProviderErrorType\n  | UnknownRpcErrorType\n  | UnsupportedProviderMethodErrorType\n  | UserRejectedRequestErrorType\n  | WebSocketRequestErrorType\n  | WithRetryErrorType\n  | ErrorType\n\nexport function buildRequest<request extends (args: any) => Promise<any>>(\n  request: request,\n  options: EIP1193RequestOptions = {},\n): EIP1193RequestFn {\n  return async (args, overrideOptions = {}) => {\n    const {\n      dedupe = false,\n      retryDelay = 150,\n      retryCount = 3,\n      uid,\n    } = {\n      ...options,\n      ...overrideOptions,\n    }\n    const requestId = dedupe\n      ? keccak256(stringToHex(`${uid}.${stringify(args)}`))\n      : undefined\n    return withDedupe(\n      () =>\n        withRetry(\n          async () => {\n            try {\n              return await request(args)\n            } catch (err_) {\n              const err = err_ as unknown as RpcError<\n                RpcErrorCode | ProviderRpcErrorCode\n              >\n              switch (err.code) {\n                // -32700\n                case ParseRpcError.code:\n                  throw new ParseRpcError(err)\n                // -32600\n                case InvalidRequestRpcError.code:\n                  throw new InvalidRequestRpcError(err)\n                // -32601\n                case MethodNotFoundRpcError.code:\n                  throw new MethodNotFoundRpcError(err, { method: args.method })\n                // -32602\n                case InvalidParamsRpcError.code:\n                  throw new InvalidParamsRpcError(err)\n                // -32603\n                case InternalRpcError.code:\n                  throw new InternalRpcError(err)\n                // -32000\n                case InvalidInputRpcError.code:\n                  throw new InvalidInputRpcError(err)\n                // -32001\n                case ResourceNotFoundRpcError.code:\n                  throw new ResourceNotFoundRpcError(err)\n                // -32002\n                case ResourceUnavailableRpcError.code:\n                  throw new ResourceUnavailableRpcError(err)\n                // -32003\n                case TransactionRejectedRpcError.code:\n                  throw new TransactionRejectedRpcError(err)\n                // -32004\n                case MethodNotSupportedRpcError.code:\n                  throw new MethodNotSupportedRpcError(err, {\n                    method: args.method,\n                  })\n                // -32005\n                case LimitExceededRpcError.code:\n                  throw new LimitExceededRpcError(err)\n                // -32006\n                case JsonRpcVersionUnsupportedError.code:\n                  throw new JsonRpcVersionUnsupportedError(err)\n                // 4001\n                case UserRejectedRequestError.code:\n                  throw new UserRejectedRequestError(err)\n                // 4100\n                case UnauthorizedProviderError.code:\n                  throw new UnauthorizedProviderError(err)\n                // 4200\n                case UnsupportedProviderMethodError.code:\n                  throw new UnsupportedProviderMethodError(err)\n                // 4900\n                case ProviderDisconnectedError.code:\n                  throw new ProviderDisconnectedError(err)\n                // 4901\n                case ChainDisconnectedError.code:\n                  throw new ChainDisconnectedError(err)\n                // 4902\n                case SwitchChainError.code:\n                  throw new SwitchChainError(err)\n                // CAIP-25: User Rejected Error\n                // https://docs.walletconnect.com/2.0/specs/clients/sign/error-codes#rejected-caip-25\n                case 5000:\n                  throw new UserRejectedRequestError(err)\n                default:\n                  if (err_ instanceof BaseError) throw err_\n                  throw new UnknownRpcError(err as Error)\n              }\n            }\n          },\n          {\n            delay: ({ count, error }) => {\n              // If we find a Retry-After header, let's retry after the given time.\n              if (error && error instanceof HttpRequestError) {\n                const retryAfter = error?.headers?.get('Retry-After')\n                if (retryAfter?.match(/\\d/))\n                  return Number.parseInt(retryAfter) * 1000\n              }\n\n              // Otherwise, let's retry with an exponential backoff.\n              return ~~(1 << count) * retryDelay\n            },\n            retryCount,\n            shouldRetry: ({ error }) => shouldRetry(error),\n          },\n        ),\n      { enabled: dedupe, id: requestId },\n    )\n  }\n}\n\n/** @internal */\nexport function shouldRetry(error: Error) {\n  if ('code' in error && typeof error.code === 'number') {\n    if (error.code === -1) return true // Unknown error\n    if (error.code === LimitExceededRpcError.code) return true\n    if (error.code === InternalRpcError.code) return true\n    return false\n  }\n  if (error instanceof HttpRequestError && error.status) {\n    // Forbidden\n    if (error.status === 403) return true\n    // Request Timeout\n    if (error.status === 408) return true\n    // Request Entity Too Large\n    if (error.status === 413) return true\n    // Too Many Requests\n    if (error.status === 429) return true\n    // Internal Server Error\n    if (error.status === 500) return true\n    // Bad Gateway\n    if (error.status === 502) return true\n    // Service Unavailable\n    if (error.status === 503) return true\n    // Gateway Timeout\n    if (error.status === 504) return true\n    return false\n  }\n  return true\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}